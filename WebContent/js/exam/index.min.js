layui.config({base:basePath+"js/",version:(new Date).getTime()});layui.use(["laypage","layer","table","element","slider","commons","combo","form","upload","rest"],function(){var e={};var t=layui.laypage,a=layui.layer,i=layui.table,n=layui.element,l=layui.slider,r=layui.form,o=layui.commons(),s=layui.jquery,c=layui.combo(),d=layui.rest(),u=layui.upload;var m=a.load(1,{shade:[.5,"#ccc"]});i.render({id:"userTable",elem:"#demo",height:"full-0",method:"post",url:"queryPage.do",title:"课程列表",limit:10,limits:[10,15,20,30,50,100],page:{layout:["limit","prev","page","next","skip","count"],groups:5},toolbar:"#toolbar",defaultToolbar:[],totalRow:false,cols:[[{type:"checkbox"},{title:"序号",type:"numbers",align:"center",width:70},{title:"岗位",align:"center",width:150,field:"postionName"},{title:"课程",align:"center",width:150,field:"courseName"},{title:"测试类型",width:80,align:"center",templet:function(e){return e.exam.type==1?"复审":"初审"}},{field:"usercode",title:"工号",align:"center",width:120},{field:"username",title:"姓名",align:"center",width:100},{templet:function(e){return e.exam.beginDate},title:"开始时间",align:"center",width:100},{templet:function(e){return e.exam.endDate},title:"结束时间",align:"center",width:100},{templet:function(e){return["未开始","已开始","已结束","已取消"][e.status]},title:"状态",align:"center",width:80},{templet:function(e){return["未开始","已提交","已评分"][e.state]},title:"答题状态",align:"center",width:80},{field:"result",title:"考核结果",align:"center",width:80}]],done:function(t){a.close(m);r.val("queryform",e)}});window.reloadTable=function(t){m=a.load(1,{shade:[.5,"#ccc"]});s.extend(true,e,t);i.reload("userTable",{where:e})};s(".btn-cancel").click(function(e){var t=s(e.target).parents(".layui-layer").attr("id").replace("layui-layer","");a.close(t)});i.on("toolbar(test)",function(e){var t=i.checkStatus(e.config.id),n=t.data;switch(e.event){case"reset":s("#form1")[0].reset();return;break}if(e.event!="cancel"&&n.length!=1){a.msg("请选择一条数据");return}var l=n[0];switch(e.event){case"detail":top.active.tabAdd("exam/detail2.html?id="+l.exam.id,"test2","测试详请");top.active.tabChange("test2");break;case"edit":if(l.state==1&&l.status==1){}else{a.msg("禁止操作,答题状态需为已提交且状态应为已开始");return}var r=top.active.getCurrentID();top.active.tabAdd("exam/score.html?tab="+r+"&id1="+l.id+"&id="+l.exam.id,"mask","评分");top.active.tabChange("mask");break;case"cancel":if(n.length==0){a.msg("请选择数据");return}for(var o=0;o<n.length;o++){if(n[o].status!=1){a.msg("状态错误必须为已开始");return}}f("cancel.do",{ids:n.map(e=>e.id).join(",")});break}});i.on("tool(test)",function(e){var t=e.data,a=e.event;switch(a){case"detail":top.active.tabAdd("exam/detail2.html?id="+t.exam.id,"test2","测试详请");top.active.tabChange("test2");break;case"edit":var i=top.active.getCurrentID();top.active.tabAdd("exam/score.html?tab="+i+"&id1="+t.id+"&id="+t.exam.id,"mask","评分");top.active.tabChange("mask");break;case"start":f("start.do",{id:t.id});break;case"cancel":f("cancel.do",{id:t.id});break;case"finish":f("finish.do",{id:t.id});break}});function f(e,t){s.ajax({type:"post",url:e,dateType:"json",contentType:"application/json",data:JSON.stringify(t),success:function(e){if(e.flag){reloadTable({});o.showInfo(e.message);return}a.msg(e.message)}})}r.on("submit(exportData)",function(t){s.extend(true,t.field,e);submitForm(t.field);return false});r.on("submit(query)",function(t){e=t.field;reloadTable(t.field);return false})});function submitForm(e){$("#xiazai").form({url:"exportData.do",onSubmit:function(t){$.extend(true,t,e)}});$("#xiazai").submit()}