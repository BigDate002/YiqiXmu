layui.config({base:"../js/",version:"<%=System.currentTimeMillis()%>"});layui.use(["laypage","layer","table","element","slider","commons","form","laydate","combo","upload"],function(){var e=true;var t={};var a=layui.laypage,l=layui.layer,i=layui.table,r=layui.element,o=layui.slider,n=layui.form,d=layui.commons(),u=layui.jquery,c=layui.combo(),s=layui.laydate,f=layui.upload;var m=new Date;var y=l.load(1,{shade:[.5,"#ccc"]});i.render({id:"userTable",elem:"#demo",height:"full-0",method:"post",url:"..//examresult/queryPageI.do",title:"考核列表",limit:10,limits:[10,15,20,30,50,100],page:{layout:["limit","prev","page","next","skip","count"],groups:5},toolbar:"#toolbar",defaultToolbar:[],totalRow:false,cols:[[{type:"checkbox",fixed:"left"},{type:"numbers",title:"序号",width:60,align:"center"},{field:"department",title:"部门",width:120,align:"center"},{field:"workShop",title:"科室/车间",width:120,align:"center"},{field:"workGroup",title:"班组",width:120,align:"center"},{field:"usercode",title:"工号",width:120,align:"center"},{field:"username",title:"姓名",width:120,align:"center"},{field:"year",title:"考核时间",width:90,align:"center",templet:function(e){return e.year+"年"+e.month+"月"}},{field:"result",title:"考核结果",width:80,align:"center"},{title:"操作",fixed:"right",width:120,toolbar:"#barDemo",align:"center"}]],done:function(a){l.close(y);n.val("queryform",t);lay(".test-item").each(function(){s.render({elem:this,format:"yyyy年MM月",type:"month",trigger:"click"})});if(e){f.render({elem:u("[lay-event=importExcel]"),url:"importData.do",accept:"file",field:"filename",acceptMime:".xlsx",exts:"xlsx",multiple:true,before:function(e){l.load()},done:function(e){l.closeAll();if(e.flag){d.showInfo(e.message);reloadTable();return}l.msg(e.message)}});e=false}}});i.on("tool(test)",function(e){if(e===false)return;var t=e.data,a=e.event;if(a==="edit"){n.val("frm1",t);u("#year").val(t.year+"年"+t.month+"月");u("#year").attr("disabled",true);u("#usercode").attr("disabled",true);n.render("select");idx=l.open({type:1,content:u("#dlg"),title:"编辑",area:["600px","425px"],cancel:function(){u("#dlg").hide()}})}});i.on("toolbar(test)",function(e){var t=i.checkStatus(e.config.id),a=t.data;switch(e.event){case"reset":document.getElementById("queryform").reset();break;case"downloadfile":u("#download").attr("src","downloadTemplate.do");break;case"create":n.val("frm1",{id:"",year:m.getFullYear()+"年"+(m.getMonth()==0?12:m.getMonth())+"月",usercode:"",result:""});u("#year").removeAttr("disabled");u("#usercode").removeAttr("disabled");n.render("select");idx=l.open({type:1,content:u("#dlg"),title:"新增",area:["600px","425px"],cancel:function(){u("#dlg").hide()}});break}});n.on("submit(query)",function(e){t=e.field;reloadTable(e.field);return false});window.reloadTable=function(a){y=l.load(1,{shade:[.5,"#ccc"]});u.extend(true,t,a);e=true;i.reload("userTable",{where:t});g(t.departmentId)};var p=c.config.data;var g=function(e){var t={};if(e){t.departmentId=e}c.set({elem:"usercode",valueField:"usercode",url:"../train/queryUserbypostion.do",param:t}).render();p=c.config.data};g();n.on("submit(tijiao)",function(e){if(e.field.year&&e.field.year!=""){var t=e.field.year.split("年");e.field.year=t[0];e.field.month=t[1].split("月")[0]}var a=JSON.stringify(e.field);var i="create.do";if(e.field.id){i="update.do"}l.load();u.ajax({type:"post",url:i,dateType:"json",contentType:"application/json",data:a,success:function(e){l.closeAll();if(e.flag){l.close(idx);reloadTable({});d.showInfo(e.message);return}l.msg(e.message)},error:function(){l.msg("网络错误")}});return false});n.on("submit(exportData)",function(e){u.extend(true,e.field,t);submitForm(e.field);return false});u(".btn-cancel").click(function(e){l.close(idx)})});function submitForm(e){$("#xiazai").form({url:"exportData.do",onSubmit:function(t){$.extend(true,t,e)}});$("#xiazai").submit()}