function downloadFile(e){$("#download").attr("src","downloadFile.do?id="+e)}layui.config({base:basePath+"js/",version:(new Date).getTime()}),layui.use(["laypage","layer","table","element","slider","commons","combo","form","upload"],function(){var e=0,t=(layui.laypage,layui.upload),i=layui.layer,l=layui.table,a=(layui.element,layui.slider,layui.form),o=layui.commons(),n=layui.jquery,s=(layui.combo(),UE.getEditor("editor"),i.load(1,{shade:[.5,"#ccc"]}));l.render({id:"userTable",elem:"#demo",height:"full-0",method:"post",url:basePath+"news/queryPage.do",title:"角色列表",limit:10,limits:[10,15,20,30,50,100],page:{layout:["limit","prev","page","next","skip","count"],groups:5},toolbar:"#toolbar",defaultToolbar:[],totalRow:!1,cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"ID",width:60,align:"center"},{field:"title",title:"标题",width:300,align:"left"},{title:"附件(点击下载)",width:300,align:"left",templet:function(e){if(null!=e.files)return e.files.map(function(e){return'<button onclick="downloadFile('+e.id+')" class="layui-btn layui-btn-xs layui-btn-primary layui-bg-orange">'+e.fileName+"</button>"}).join(" ").toString()}},{title:"操作",fixed:"right",toolbar:"#barDemo",width:120}]],done:function(e){i.close(s)}});t.render({elem:"#test1",url:"upload.do",accept:"file",field:"filename",multiple:!1,before:function(){s=i.load(1,{content:"<br/><br/><label>     上传中....</label>",icon:4,time:6e4,shade:[.4,"#eff"]})},done:function(e){i.close(s),e.flag?(o.showInfo("上传成功"),n("#file").append('<span class="layui-badge layui-bg-orange" style="width:auto;display:inline-block;text-align:left;margin-right:5px;margin-top:5px;">'+e.message+'<i data-title="'+e.message+'" data-id="'+e.msg+'" class="layui-icon fujian" style="float:right;cursor: pointer;color:white;" onclick="removeThis(this)">&#x1006;</i></span>')):o.showInfo(e.message)}});window.removeThis=function(e){n(e).parent().remove()},a.on("submit(tijiao)",function(t){var a=[];n(".fujian").each(function(e){var t={};t.url=n(this).attr("data-id"),t.fileName=n(this).attr("data-title"),a.push(t)}),t.field.files=a;var s=JSON.stringify(t.field),d="create.do";return t.field.id&&(d="update.do"),n.ajax({type:"post",url:d,dateType:"json",contentType:"application/json",data:s,success:function(t){if(t.flag)return i.close(e),l.reload("userTable"),void o.showInfo(t.message);i.msg(t.message)}}),!1}),n(".btn-cancel").click(function(t){i.close(e)}),l.on("tool(test)",function(t){if(!1!==t){var s=t.data,d=t.event;if("detail"===d){var r="";null!=s.files&&(r="<h4>附件:"+(r=s.files.map(function(e){return'<button onclick="downloadFile('+e.id+')" class="layui-btn layui-btn-xs layui-btn-primary layui-bg-orange">'+e.fileName+"</button>"}).join(" ").toString())+"</h4>"),i.open({title:"查看详情",skin:"layui-layer-molv",type:1,area:["640px","430px"],closeBtn:1,shade:.5,content:"<center><h2>"+s.title+"</h2>"+r+"</center><div>"+s.content+"</div>"})}else"delete"===d?i.confirm("确定删除选中数据？",{btn:["确定","取消"]},function(e){i.close(e),n.ajax({type:"post",url:"delete.do?id="+s.id,dateType:"json",contentType:"application/json",success:function(e){e.flag&&(l.reload("userTable"),o.showInfo(e.message))}})}):"edit"===d&&(loadKeshi(s.departmentId),a.val("frm1",s),e=i.open({type:1,content:n("#dlg"),title:"编辑公告",area:["800px","425px"],cancel:function(){n("#dlg").hide()}}))}}),l.on("toolbar(test)",function(t){l.checkStatus(t.config.id).data;switch(t.event){case"create":document.getElementById("frm1").reset(),n("#file").html(""),e=i.open({type:1,content:n("#dlg"),title:"添加公告",area:["800px","450px"],cancel:function(){n("#dlg").hide()}})}})});