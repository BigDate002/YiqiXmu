function downloadFile(e){$("#download").attr("src","downloadFile.do?id="+e)}layui.config({base:basePath+"js/",version:(new Date).getTime()});layui.use(["laypage","layer","table","element","slider","commons","combo","form","upload"],function(){var e=0;var t=layui.laypage,i=layui.upload,a=layui.layer,l=layui.table,n=layui.element,o=layui.slider,s=layui.form,r=layui.commons(),d=layui.jquery,c=layui.combo();var u=UE.getEditor("editor");var f=a.load(1,{shade:[.5,"#ccc"]});l.render({id:"userTable",elem:"#demo",height:"full-0",method:"post",url:basePath+"news/queryPage.do",title:"角色列表",limit:10,limits:[10,15,20,30,50,100],page:{layout:["limit","prev","page","next","skip","count"],groups:5},toolbar:"#toolbar",defaultToolbar:[],totalRow:false,cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"ID",width:60,align:"center"},{field:"title",title:"标题",width:300,align:"left"},{title:"附件(点击下载)",width:300,align:"left",templet:function(e){if(e.files!=null)return e.files.map(function(e){return'<button onclick="downloadFile('+e.id+')" class="layui-btn layui-btn-xs layui-btn-primary layui-bg-orange">'+e.fileName+"</button>"}).join(" ").toString()}},{title:"操作",fixed:"right",toolbar:"#barDemo",width:120}]],done:function(e){a.close(f)}});var p=i.render({elem:"#test1",url:"upload.do",accept:"file",field:"filename",multiple:false,before:function(){f=a.load(1,{content:"<br/><br/><label>     上传中....</label>",icon:4,time:6e4,shade:[.4,"#eff"]})},done:function(e){a.close(f);if(e.flag){r.showInfo("上传成功");d("#file").append('<span class="layui-badge layui-bg-orange" style="width:auto;display:inline-block;text-align:left;margin-right:5px;margin-top:5px;">'+e.message+'<i data-title="'+e.message+'" data-id="'+e.msg+'" class="layui-icon fujian" style="float:right;cursor: pointer;color:white;" onclick="removeThis(this)">&#x1006;</i></span>')}else{r.showInfo(e.message)}}});window.removeThis=function(e){d(e).parent().remove()};s.on("submit(tijiao)",function(t){var i=[];d(".fujian").each(function(e){var t={};t.url=d(this).attr("data-id");t.fileName=d(this).attr("data-title");i.push(t)});t.field.files=i;var n=JSON.stringify(t.field);var o="create.do";if(t.field.id){o="update.do"}d.ajax({type:"post",url:o,dateType:"json",contentType:"application/json",data:n,success:function(t){if(t.flag){a.close(e);l.reload("userTable");r.showInfo(t.message);return}a.msg(t.message)}});return false;return false});d(".btn-cancel").click(function(t){a.close(e)});l.on("tool(test)",function(t){if(t===false)return;var i=t.data,n=t.event;if(n==="detail"){var o="";if(i.files!=null){o=i.files.map(function(e){return'<button onclick="downloadFile('+e.id+')" class="layui-btn layui-btn-xs layui-btn-primary layui-bg-orange">'+e.fileName+"</button>"}).join(" ").toString();o="<h4>附件:"+o+"</h4>"}a.open({title:"查看详情",skin:"layui-layer-molv",type:1,area:["640px","430px"],closeBtn:1,shade:.5,content:"<center><h2>"+i.title+"</h2>"+o+"</center><div>"+i.content+"</div>"})}else if(n==="delete"){a.confirm("确定删除选中数据？",{btn:["确定","取消"]},function(e){a.close(e);d.ajax({type:"post",url:"delete.do?id="+i.id,dateType:"json",contentType:"application/json",success:function(e){if(e.flag){l.reload("userTable");r.showInfo(e.message)}}})})}else if(n==="edit"){loadKeshi(i.departmentId);s.val("frm1",i);e=a.open({type:1,content:d("#dlg"),title:"编辑公告",area:["800px","425px"],cancel:function(){d("#dlg").hide()}})}});l.on("toolbar(test)",function(t){var i=l.checkStatus(t.config.id),n=i.data;switch(t.event){case"create":document.getElementById("frm1").reset();d("#file").html("");e=a.open({type:1,content:d("#dlg"),title:"添加公告",area:["800px","450px"],cancel:function(){d("#dlg").hide()}});break}})});